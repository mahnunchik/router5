!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).router5={})}(this,function(e){"use strict";var P=function(){return(P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1};var t,r,n=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function u(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}}function f(e){return encodeURIComponent(e)}function d(e){return decodeURIComponent(e)}function p(r,e,t){var n,a="index"===(n=t).arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===n.arrayFormat?function(e){return e+"[]"}:function(e){return e};return e.map(function(e,t){return a(r,t)+"="+f(e)}).join("&")}function s(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)}function h(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}}function c(e,t){var l=u(t);return s(e).split("&").reduce(function(e,t){var r=t.split("="),n=r[0],a=r[1],i=h(n),o=i.hasBrackets,u=i.name,s=e[u],c=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===d(e))return!0;if("✗"===d(e))return!1}else if("string"===t.nullFormat&&"null"===e)return null;return d(e)}(a,l);return e[u]=void 0===s?o?[c]:c:[].concat(s,c),e},{})}t.parse=c,t.build=function(c,e){var l=u(e);return Object.keys(c).filter(function(e){return void 0!==c[e]}).map(function(e){return r=c[t=e],n=l,null===r?(a=t,"hidden"===(i=n).nullFormat?"":"string"===i.nullFormat?a+"=null":a):"boolean"==typeof r?(o=t,u=r,"empty-true"===(s=n).booleanFormat&&u?o:o+"="+("unicode"===s.booleanFormat?u?"✓":"✗":u.toString())):Array.isArray(r)?p(t,r,n):t+"="+f(r);var t,r,n,a,i,o,u,s}).filter(Boolean).join("&")},t.omit=function(e,o,t){var r=u(t);if(""===s(e))return{querystring:"",removedParams:{}};var n=e.split("&").reduce(function(e,t){var r=e[0],n=e[1],a=t.split("=")[0],i=h(a).name;return-1===o.indexOf(i)?[r.concat(t),n]:[r,n.concat(t)]},[[],[]]),a=n[0],i=n[1];return{querystring:a.join("&"),removedParams:c(i.join("&"),r)}},t.keep=function(e,o,t){var r=u(t);if(""===s(e))return{keptParams:{},querystring:""};var n=e.split("&").reduce(function(e,t){var r=e[0],n=e[1],a=t.split("=")[0],i=h(a).name;return 0<=o.indexOf(i)?[r.concat(t),n]:[r,n.concat(t)]},[[],[]]),a=n[0];n[1];return{keptParams:c(a.join("&"),r),querystring:a.join("&")}}}(t={exports:{}},t.exports),t.exports);(r=n)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")&&r.default;function c(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@]+")+")"}function l(e){return e}function f(e){return null!=e}var y=n.parse,m=n.build,T=n.omit,d=(n.keep,Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}),a=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(c(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+c(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],i=function(r,n){if(void 0===n&&(n=[]),!a.some(function(e){var t=r.match(e.pattern);return!!t&&(n.push({type:e.name,match:t[0],val:t.slice(1,2),otherVal:t.slice(2),regex:e.regex instanceof Function?e.regex(t):e.regex}),t[0].length<r.length&&(n=i(r.substr(t[0].length),n)),!0)}))throw new Error("Could not parse path '"+r+"'");return n},s=(o.createPath=function(e){return new o(e)},o.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},o.prototype.test=function(e,t){var r,n=this,a=d({strictTrailingSlash:!1,queryParams:{}},t),i=(r=this.source,a.strictTrailingSlash||"\\/"===r?r:r.replace(/\\\/$/,"")+"(?:\\/)?"),o=this.urlTest(e,i+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!o||!this.hasQueryParams)return o;var u=y(e,a.queryParams);return 0===Object.keys(u).filter(function(e){return!n.isQueryParam(e)}).length?(Object.keys(u).forEach(function(e){return o[e]=u[e]}),o):null},o.prototype.partialTest=function(e,t){var r,n=this,a=d({delimited:!0,queryParams:{}},t),i=(r=this.source,a.delimited?/(\/)$/.test(r)?r:r+"(\\/|\\?|\\.|;|$)":r),o=this.urlTest(e,i,a);if(!o)return o;if(!this.hasQueryParams)return o;var u=y(e,a.queryParams);return Object.keys(u).filter(function(e){return n.isQueryParam(e)}).forEach(function(e){return function(e,t,r){void 0===r&&(r="");var n=e[t];return e[t]=void 0===n?r:Array.isArray(n)?n.concat(r):[n,r],e}(o,e,u[e])}),o},o.prototype.build=function(a,e){var i=this;void 0===a&&(a={});var t=d({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},e),r=Object.keys(a).filter(function(e){return!i.isQueryParam(e)}).reduce(function(e,t){if(!f(a[t]))return e;var r=a[t],n=i.isQueryParam(t)?l:encodeURI;return"boolean"==typeof r?e[t]=r:Array.isArray(r)?e[t]=r.map(n):e[t]=n(r),e},{});if(this.urlParams.some(function(e){return!f(a[e])})){var n=this.urlParams.filter(function(e){return!f(a[e])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+n.join(", ")+" }")}if(!t.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+c(e.otherVal[0])+"$").test(r[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var o=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+r[e.val[0]]:/^url-parameter/.test(e.type)?r[e.val[0]]:e.match}).join("");if(t.ignoreSearch)return o;var u=this.queryParams.filter(function(e){return-1!==Object.keys(a).indexOf(e)}).reduce(function(e,t){return e[t]=a[t],e},{}),s=m(u,t.queryParams);return s?o+"?"+s:o},o.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map(function(e){return e.val[0]})},o.prototype.urlTest=function(e,t,r){var n=this,a=(void 0===r?{}:r).caseSensitive,i=new RegExp("^"+t,void 0!==a&&a?"":"i"),o=e.match(i);return o?this.urlParams.length?o.slice(1,this.urlParams.length+1).reduce(function(e,t,r){return e[n.urlParams[r]]=decodeURIComponent(t),e},{}):{}:null},o);function o(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=i(e),this.hasUrlParams=0<this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length,this.hasSpatParam=0<this.tokens.filter(function(e){return/splat$/.test(e.type)}).length,this.hasMatrixParams=0<this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length,this.hasQueryParams=0<this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}function p(e){var a="";return e.reduce(function(e,t){var r=t.parser.urlParams.reduce(function(e,t){return e[t]="url",e},{}),n=t.parser.queryParams.reduce(function(e,t){return e[t]="query",e},r);return void 0!==t.name&&(e[a=a?a+"."+t.name:t.name]=n),e},{})}var h=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},S=function(e,s,c,l,f){void 0===l&&(l={});for(var t=l.queryParamsMode,d=void 0===t?"default":t,r=l.strictTrailingSlash,p=void 0!==r&&r,n=l.strongMatching,h=void 0===n||n,a=l.caseSensitive,m=void 0!==a&&a,v=1===e.length&&""===e[0].name,i=function(e){var t,r=void 0,n=s;if("/"===f&&"/"===e.path&&(n="/"+s),e.children.length||(t=e.parser.test(n,{caseSensitive:m,strictTrailingSlash:p,queryParams:l.queryParams})),t=t||e.parser.partialTest(n,{delimited:h,caseSensitive:m,queryParams:l.queryParams})){var a=e.parser.build(t,{ignoreSearch:!0});p||e.children.length||(a=a.replace(/\/$/,"")),r=0===n.toLowerCase().indexOf(a.toLowerCase())?n.slice(a.length):n,p||e.children.length||(r=r.replace(/^\/\?/,"?"));var i=T(n.replace(a,"").split("?")[1]||"",e.parser.queryParams,l.queryParams).querystring;if(r=r.split("?")[0]+(i?"?"+i:""),p||v||"/"!==r||/\/$/.test(a)||(r=""),c.segments.push(e),Object.keys(t).forEach(function(e){return c.params[e]=t[e]}),!v&&!r.length)return{value:c};if(!v&&"strict"!==d&&0===r.indexOf("?")){var o=y(r.slice(1),l.queryParams);return Object.keys(o).forEach(function(e){return c.params[e]=o[e]}),{value:c}}var u=e.getNonAbsoluteChildren();return u.length?{value:S(u,r,c,l,a)}:{value:null}}},o=0,u=e;o<u.length;o++){var g=i(u[o]);if("object"==typeof g)return g.value}return null};function v(e){var l,t=e.slice(0);return e.sort((l=t,function(e,t){var r=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),n=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===r)return 1;if("/"===n)return-1;if(e.parser.hasSpatParam)return 1;if(t.parser.hasSpatParam)return-1;var a=(r.match(/\//g)||[]).length,i=(n.match(/\//g)||[]).length;if(a<i)return 1;if(i<a)return-1;var o=e.parser.urlParams.length,u=t.parser.urlParams.length;if(o<u)return-1;if(u<o)return 1;var s=(r.split("/").slice(-1)[0]||"").length,c=(n.split("/").slice(-1)[0]||"").length;return s<c?1:c<s?-1:l.indexOf(e)-l.indexOf(t)}))}h({},{queryParamsMode:"default",trailingSlashMode:"default"},{strongMatching:!0});var g=(O.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},O.prototype.setParent=function(e){this.parent=e,this.checkParents()},O.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new s(e):null},O.prototype.add=function(e,t,r){var n=this;if(void 0===r&&(r=!0),null!=e){if(!(e instanceof Array)){if(!(e instanceof O||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof O)e.setParent(this),this.addRouteNode(e,r);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new O(e.name,e.path,e.children,t,this,!1,r),i=a.getParentSegments([a]).map(function(e){return e.name}).join(".");t&&t(h({},e,{name:i})),this.addRouteNode(a,r)}return this}e.forEach(function(e){return n.add(e,t,r)})}},O.prototype.addNode=function(e,t){return this.add(new O(e,t)),this},O.prototype.getPath=function(e){return(t=this.getSegmentsByName(e))?t.map(function(e){return e.path}).join(""):null;var t},O.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},O.prototype.sortChildren=function(){this.children.length&&v(this.children)},O.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},O.prototype.buildPath=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),function(e,n,a){if(void 0===n&&(n={}),void 0===a&&(a={}),!e)return null;for(var t=a.queryParamsMode,r=void 0===t?"default":t,i=(a.trailingSlashMode,[]),o=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;i.push.apply(i,c.queryParams),o.push.apply(o,c.urlParams),o.push.apply(o,c.spatParams)}if("loose"===r){var l=Object.keys(n).reduce(function(e,t){return-1===i.indexOf(t)&&-1===o.indexOf(t)?e.concat(t):e},[]);i.push.apply(i,l)}var f=i.reduce(function(e,t){return-1!==Object.keys(n).indexOf(t)&&(e[t]=n[t]),e},{}),d=m(f,a.queryParams),p=e.reduce(function(e,t){var r=t.parser.build(n,{ignoreSearch:!0,queryParams:a.queryParams});return t.absolute?r:e+r},"").replace(/\/\/{1,}/g,"/"),h=p;return"always"===a.trailingSlashMode?h=/\/$/.test(p)?p:p+"/":"never"===a.trailingSlashMode&&"/"!==p&&(h=/\/$/.test(p)?p.slice(0,-1):p),h+(d?"?"+d:"")}(this.getSegmentsByName(e),t,r)},O.prototype.buildState=function(e,t){void 0===t&&(t={});var r=this.getSegmentsByName(e);return r&&r.length?{name:e,params:t,meta:p(r)}:null},O.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var r,n=this.getSegmentsMatchingPath(e,t);if(n){var a=n.segments;if(a[0].absolute){var i=a[0].getParentSegments();a.reverse(),a.push.apply(a,i),a.reverse()}var o=a[a.length-1].findSlashChild();o&&a.push(o)}return(r=n)&&r.segments&&r.segments.length?{name:r.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:r.params,meta:p(r.segments)}:null},O.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var r=e.name.split(".");if(1===r.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{var n=this.getSegmentsByName(r.slice(0,-1).join("."));if(!n)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=r[r.length-1],n[n.length-1].add(e)}return this},O.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},O.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},O.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},O.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},O.prototype.getSegmentsByName=function(e){var a=[],i=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var t,r,n=(t=e,(r=i.filter(function(e){return e.name===t})).length?r[0]:void 0);return!!n&&(i=n.children,a.push(n),!0)})?a:null},O.prototype.getSegmentsMatchingPath=function(e,t){var r=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),n=S(r,e,{segments:[],params:{}},t);return n&&1===n.segments.length&&""===n.segments[0].name?null:n},O);function O(e,t,r,n,a,i,o){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=[]),void 0===i&&(i=!0),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new s(this.path):null,this.children=[],this.parent=a,this.checkParents(),this.add(r,n,!i&&!1!==o),i&&this.sortDescendants(),this}var E={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},R={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function N(o){var i=0,t=null;return o.getState=function(){return t},o.setState=function(e){t=e},o.makeState=function(e,t,r,n,a){return{name:e,params:P(P({},o.config.defaultParams[e]),t),path:r,meta:n?P(P({},n),{id:void 0===a?++i:a}):void 0}},o.makeNotFoundState=function(e,t){return o.makeState(R.UNKNOWN_ROUTE,{path:e},e,{options:t})},o.areStatesEqual=function(t,r,e){if(void 0===e&&(e=!0),t.name!==r.name)return!1;function n(e){return o.rootNode.getSegmentsByName(e).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])}var a=e?n(t.name):Object.keys(t.params),i=e?n(r.name):Object.keys(r.params);return a.length===i.length&&a.every(function(e){return t.params[e]===r.params[e]})},o.areStatesDescendants=function(t,r){return!!new RegExp("^"+t.name+"\\.(.*)$").test(r.name)&&Object.keys(t.params).every(function(e){return t.params[e]===r.params[e]})},o.forwardState=function(e,t){var r=o.config.forwardMap[e]||e;return{name:r,params:P(P(P({},o.config.defaultParams[e]),o.config.defaultParams[r]),t)}},o.buildState=function(e,t){var r=o.forwardState(e,t),n=r.name,a=r.params;return o.rootNode.buildState(n,a)},o}var b,A={onStart:R.ROUTER_START,onStop:R.ROUTER_STOP,onTransitionSuccess:R.TRANSITION_SUCCESS,onTransitionStart:R.TRANSITION_START,onTransitionError:R.TRANSITION_ERROR,onTransitionCancel:R.TRANSITION_CANCEL};function _(a){var i=[];return a.getPlugins=function(){return i},a.usePlugin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.map(function(e){return i.push(e),t=e,r=a.executeFactory(t),n=Object.keys(A).map(function(e){if(r[e])return a.addEventListener(A[e],r[e])}).filter(Boolean),function(){n.forEach(function(e){return e()}),r.teardown&&r.teardown()};var t,r,n});return function(){i=i.filter(function(e){return-1===t.indexOf(e)}),r.forEach(function(e){return e()})}},a}function w(n){var a=[],i=[];return n.useMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.map(function(t){var r=n.executeFactory(t);return a.push(t),i.push(r),function(){a=a.filter(function(e){return e!==t}),i=i.filter(function(e){return e!==r})}});return function(){return r.forEach(function(e){return e()})}},n.clearMiddleware=function(){return a=[],i=[],n},n.getMiddlewareFactories=function(){return a},n.getMiddlewareFunctions=function(){return i},n}b="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")();var C,k,j=("function"==typeof(k=b.Symbol)?k.observable?C=k.observable:(C=k("observable"),k.observable=C):C="@@observable",C);function x(a){var n={};function t(e){var t="object"==typeof e,r=t?e.next.bind(e):e,n=a.addEventListener(R.TRANSITION_SUCCESS,function(e,t){r({route:e,previousRoute:t})});return t?{unsubscribe:n}:n}function e(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return t(e)}})[j]=function(){return this},e}return a.invokeEventListeners=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];(n[e]||[]).forEach(function(e){return e.apply(void 0,t)})},a.removeEventListener=function(e,t){n[e]=n[e].filter(function(e){return e!==t})},a.addEventListener=function(e,t){return n[e]=(n[e]||[]).concat(t),function(){return a.removeEventListener(e,t)}},a.subscribe=t,a[j]=e,a["@@observable"]=e,a}var I=function(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])},q=function(e){return e&&e.meta&&e.meta.params},U=function(e,r){return q(r)&&null!=r.meta.params[e]?Object.keys(r.meta.params[e]).reduce(function(e,t){return e[t]=r.params[t],e},{}):{}};function D(i,o){var e,t=i.meta&&i.meta&&i.meta.options||{},u=o?I(o.name):[],s=I(i.name),r=Math.min(u.length,s.length);e=!o||t.reload?0:q(o)||q(i)?function(){function e(){var e=u[a],t=s[a];if(e!==t)return{value:a};var r=U(e,i),n=U(t,o);return Object.keys(r).length!==Object.keys(n).length?{value:a}:0===Object.keys(r).length?"continue":Object.keys(r).some(function(e){return n[e]!==r[e]})?{value:a}:void 0}var a;for(a=0;a<r;a+=1){var t=e();if("object"==typeof t)return t.value}return a}():0;var n=u.slice(e).reverse(),a=s.slice(e);return{intersection:o&&0<e?u[e-1]:"",toDeactivate:n,toActivate:a}}function M(o,e,u){function s(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path}function c(e,t,o,u){function r(e,t){var r,n,a,i;e?u(e):t&&t!==o&&s(t)?(a=t,(i=o).name===a.name&&i.params===a.params&&i.path===a.path||console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),u(null,(r=t,P(P(P({},n=o),r),{meta:P(P({},n.meta),r.meta)})))):u(null,o)}var n=e.call(null,o,a,r);l()?r(null):"boolean"==typeof n?r(n?null:t):s(n)?r(null,n):n&&"function"==typeof n.then&&n.then(function(e){e instanceof Error?r({error:e},null):r(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),r(P(P({},t),{promiseError:e}),null)):r("object"==typeof e?P(P({},t),e):t,null)})}var l=e.isCancelled,t=e.toState,a=e.fromState,r=e.errorKey,f=void 0===r?void 0:r,d=Array.isArray(o)?o:Object.keys(o),p=function(e,t){var r;if(l())u();else if(e)u(e);else if(d.length){var n="string"==typeof d[0],a=f&&n?((r={})[f]=d[0],r):{},i=n?o[d[0]]:d[0];d=d.slice(1),c(i,a,t,p)}else u(null,t)};p(null,t)}function F(n,a,e,t,i){function o(){return r}function u(e,t){return P(P({},e),t instanceof Object?t:{error:t})}var r=!1,s=!1,c=n.getOptions(),l=n.getLifecycleFunctions(),f=l[0],d=l[1],p=n.getMiddlewareFunctions(),h=a.name===R.UNKNOWN_ROUTE,m={isCancelled:o,toState:a,fromState:e},v=D(a,e),g=v.toDeactivate,y=v.toActivate,T=!e||t.forceDeactivate?[]:function(e,t,r){M(g.filter(function(e){return f[e]}).reduce(function(e,t){var r;return P(P({},e),((r={})[t]=f[t],r))},{}),P(P({},m),{errorKey:"segment"}),function(e){return r(e?u({code:E.CANNOT_DEACTIVATE},e):null)})},S=h?[]:function(e,t,r){M(y.filter(function(e){return d[e]}).reduce(function(e,t){var r;return P(P({},e),((r={})[t]=d[t],r))},{}),P(P({},m),{errorKey:"segment"}),function(e){return r(e?u({code:E.CANNOT_ACTIVATE},e):null)})},O=p.length?function(r,e,n){return M(p,P({},m),function(e,t){return n(e?u({code:E.TRANSITION_ERR},e):null,t||r)})}:[];return M([].concat(T).concat(S).concat(O),m,function(e,t){if(s=!0,!o()){if(!e&&c.autoCleanUp){var r=I(a.name);Object.keys(f).forEach(function(e){-1===r.indexOf(e)&&n.clearCanDeactivate(e)})}i(e,t||a)}}),function(){r||s||(r=!0,i({code:E.TRANSITION_CANCELLED},null))}}function L(e,t){}function $(f){var i;function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=e[e.length-1],a="function"==typeof n?n:L,i="object"==typeof e[1]?e[1]:{},o="object"==typeof e[2]?e[2]:{};if(f.isStarted()){var u=f.buildState(r,i);if(!u){var s={code:E.ROUTE_NOT_FOUND};return a(s),void f.invokeEventListeners(R.TRANSITION_ERROR,null,f.getState(),s)}var c=f.makeState(u.name,u.params,f.buildPath(u.name,u.params),{params:u.meta,options:o});if(!!f.getState()&&f.areStatesEqual(f.getState(),c,!1)&&!o.reload&&!o.force){s={code:E.SAME_STATES};return a(s),void f.invokeEventListeners(R.TRANSITION_ERROR,c,f.getState(),s)}var l=f.getState();return o.skipTransition?(a(null,c),L):f.transitionToState(c,l,o,function(e,t){if(e)if(e.redirect){var r=e.redirect;d(r.name,r.params,P(P({},o),{force:!0,redirected:!0}),a)}else a(e);else f.invokeEventListeners(R.TRANSITION_SUCCESS,t,l,o),a(null,t)})}a({code:E.ROUTER_NOT_STARTED})}return f.navigate=d,f.navigate=d,f.navigateToDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="object"==typeof e[0]?e[0]:{},n=2===e.length?e[1]:"function"==typeof e[0]?e[0]:L,a=f.getOptions();return a.defaultRoute?d(a.defaultRoute,a.defaultParams,r,n):function(){}},f.cancel=function(){return i&&(i("navigate"),i=null),f},f.transitionToState=function(r,n,e,a){return void 0===e&&(e={}),void 0===a&&(a=L),f.cancel(),f.invokeEventListeners(R.TRANSITION_START,r,n),i=F(f,r,n,e,function(e,t){i=null,t=t||r,e?(e.code===E.TRANSITION_CANCELLED?f.invokeEventListeners(R.TRANSITION_CANCEL,r,n):f.invokeEventListeners(R.TRANSITION_ERROR,r,n,e),a(e)):(f.setState(t),a(null,t))})},f}function z(){}function B(f){var d=!1;return f.isStarted=function(){return d},f.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,a=f.getOptions(),i=e[e.length-1],o="function"==typeof i?i:z,u="function"!=typeof e[0]?e[0]:void 0;if(d)return o({code:E.ROUTER_ALREADY_STARTED}),f;d=!0,f.invokeEventListeners(R.ROUTER_START);function s(e,t,r){void 0===r&&(r=!0),e||f.invokeEventListeners(R.TRANSITION_SUCCESS,t,null,{replace:!0}),e&&r&&f.invokeEventListeners(R.TRANSITION_ERROR,t,null,e),o(e,t)}if(void 0===u&&!a.defaultRoute)return s({code:E.NO_START_PATH_OR_STATE});if("string"==typeof u?r=u:"object"==typeof u&&(n=u),n)f.setState(n),s(null,n);else{n=void 0===r?null:f.matchPath(r);var c=function(){return f.navigateToDefault({replace:!0},o)},l=function(e){f.transitionToState(e,f.getState(),{},function(e,t){var r;e?e.redirect?(r=e.redirect,f.navigate(r.name,r.params,{replace:!0,reload:!0,redirected:!0},o)):a.defaultRoute?c():s(e,null,!1):s(null,t)})};n?l(n):a.defaultRoute?c():a.allowNotFound?l(f.makeNotFoundState(r,{replace:!0})):s({code:E.ROUTE_NOT_FOUND,path:r},null)}return f},f.stop=function(){return d&&(f.setState(null),d=!1,f.invokeEventListeners(R.ROUTER_STOP)),f},f}function Q(e){return"function"==typeof e?e:function(){return function(){return e}}}function Z(n){var a={},i={},o={},u={};return n.getLifecycleFactories=function(){return[a,i]},n.getLifecycleFunctions=function(){return[o,u]},n.canDeactivate=function(e,t){var r=Q(t);return a[e]=r,o[e]=n.executeFactory(r),n},n.clearCanDeactivate=function(e){return a[e]=void 0,o[e]=void 0,n},n.canActivate=function(e,t){var r=Q(t);return i[e]=r,u[e]=n.executeFactory(r),n},n}function K(e,t,r){var a,i,o;return void 0===e&&(e=[]),void 0===t&&(t={}),void 0===r&&(r={}),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce(function(e,t){return t(e)},e)}}((o=t,function(r){var n=P(P({},u),o);return r.getOptions=function(){return n},r.setOption=function(e,t){return n[e]=t,r},r}),(i=r,function(r){var n=i;return r.setDependency=function(e,t){return n[e]=t,r},r.setDependencies=function(t){return Object.keys(t).forEach(function(e){return r.setDependency(e,t[e])}),r},r.getDependencies=function(){return n},r.getInjectables=function(){return[r,r.getDependencies()]},r.executeFactory=function(e){return e.apply(void 0,r.getInjectables())},r}),x,N,B,Z,$,_,w,(a=e,function(d){d.forward=function(e,t){return d.config.forwardMap[e]=t,d};var n=a instanceof g?a:new g("","",a,r);function r(e){e.canActivate&&d.canActivate(e.name,e.canActivate),e.forwardTo&&d.forward(e.name,e.forwardTo),e.decodeParams&&(d.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(d.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(d.config.defaultParams[e.name]=e.defaultParams)}return d.rootNode=n,d.add=function(e,t){return n.add(e,r,!t),t&&n.sortDescendants(),d},d.addNode=function(e,t,r){return n.addNode(e,t),r&&d.canActivate(e,r),d},d.isActive=function(e,t,r,n){void 0===t&&(t={}),void 0===r&&(r=!1),void 0===n&&(n=!0);var a=d.getState();return!!a&&(r||a.name===e?d.areStatesEqual(d.makeState(e,t),a,n):d.areStatesDescendants(d.makeState(e,t),a))},d.buildPath=function(e,t){if(e===R.UNKNOWN_ROUTE)return t.path;var r=P(P({},d.config.defaultParams[e]),t),n=d.getOptions(),a=n.trailingSlashMode,i=n.queryParamsMode,o=n.queryParams,u=d.config.encoders[e]?d.config.encoders[e](r):r;return d.rootNode.buildPath(e,u,{trailingSlashMode:a,queryParamsMode:i,queryParams:o})},d.matchPath=function(e,t){var r=d.getOptions(),n=d.rootNode.matchPath(e,r);if(n){var a=n.name,i=n.params,o=n.meta,u=d.config.decoders[a]?d.config.decoders[a](i):i,s=d.forwardState(a,u),c=s.name,l=s.params,f=!1===r.rewritePathOnMatch?e:d.buildPath(c,l);return d.makeState(c,l,f,{params:o,source:t})}return null},d.setRootPath=function(e){d.rootNode.setPath(e)},d}))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})}e.RouteNode=g,e.cloneRouter=function(e,t){var r=K(e.rootNode,e.getOptions(),t);r.useMiddleware.apply(r,e.getMiddlewareFactories()),r.usePlugin.apply(r,e.getPlugins()),r.config=e.config;var n=e.getLifecycleFactories(),a=n[0],i=n[1];return Object.keys(a).forEach(function(e){return r.canDeactivate(e,a[e])}),Object.keys(i).forEach(function(e){return r.canActivate(e,i[e])}),r},e.constants=R,e.createRouter=K,e.default=K,e.errorCodes=E,e.transitionPath=D,Object.defineProperty(e,"__esModule",{value:!0})});
